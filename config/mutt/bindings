# Vim-like Mutt Bindings
# Thanks to: http://stevelosh.com/blog/2012/10/the-homely-mutt/
#            https://www.reddit.com/r/vim/comments/67n8ue/vimmy_custom_keybindings_for_mutt/dgrynw0/

# alias   - alias menu displaying suggested aliases
# browser - file/directory browser
# editor  - single line editor for `To:', `Subject:' prompts.
# index   - the main menu showing messages in a folder
# pager   - where the contents of the message are displayed
# query   - menu displaying results of query command

# Unbinding...
bind index <esc>V noop
bind index <esc>v noop
bind index \Cn noop
bind index \Cp noop
bind editor <space> noop

bind pager j next-line
bind pager k previous-line

bind alias,index,browser,query G last-entry
bind pager G bottom

bind alias,index,browser,query,pager g noop
bind alias,index,browser,query gg first-entry
bind pager gg top

bind alias,index,pager,browser,query \Cd half-down
bind alias,index,pager,browser,query \Cu half-up

bind index <esc><space> collapse-all
bind index <space> collapse-thread

bind index n search-next
bind index p search-opposite

bind index { previous-thread
bind pager { half-up

bind index } next-thread
bind pager } half-down

# Skip trash when deleting with the delete key.
bind index,pager <delete> purge-message

# Readline-like history browsing using up/down keys.
bind editor \Cn history-up
bind editor \Cp history-down

# Convenient macros to switch between common folders.  Also tells me what other
# folders have new mail once I make a switch.
macro index,pager ,d "<change-folder>$postponed<enter><buffy-list>" "open drafts"
macro index,pager ,i "<change-folder>$spoolfile<enter><buffy-list>" "open inbox"
macro index,pager ,j "<change-folder>+spam<enter><buffy-list>"      "open junk mail (spam)"
macro index,pager ,r "<change-folder>^<enter><buffy-list>"          "refresh folder"
macro index,pager ,s "<change-folder>$record<enter><buffy-list>"    "open sent mail"
macro index,pager ,t "<change-folder>$trash<enter><buffy-list>"     "open trash"


# If +spam doesn't exist, mutt will create it for us.
macro index S "<save-message>+spam<enter>" "mark message as spam"

# Toggle the mailbox list with "y".
macro index,pager y "<change-folder>?<toggle-mailboxes>" "show incoming mailboxes list"
bind browser y exit

# Call urlview with Ctrl + B.
macro index,pager,attach,compose \cb                                            \
  "<enter-command>set my_pipe_decode=\$pipe_decode pipe_decode<Enter>           \
  <pipe-message>urlscan<Enter>                                                  \
  <enter-command>set pipe_decode=\$my_pipe_decode; unset my_pipe_decode<Enter>" \
  "call urlview to extract URLs out of a message"

# Pipe message to pbcopy with Ctrl + Y.  pipe_decode will ensure that
# unnecessary headers are removed and the message is processed.
macro index,pager,attach,compose \cy                                            \
  "<enter-command>set my_pipe_decode=\$pipe_decode pipe_decode<Enter>           \
  <pipe-message>pbcopy<Enter>                                                   \
  <enter-command>set pipe_decode=\$my_pipe_decode; unset my_pipe_decode<Enter>" \
  "copy message to clipboard using mutt-pbcopy"

bind pager R group-reply

bind index <tab> sync-mailbox
bind index <space> collapse-thread

# Sync email
#macro index O "<shell-escape>offlineimap<enter>"           "run offlineimap to sync all mail"
#macro index o "<shell-escape>offlineimap -qf INBOX<enter>" "run offlineimap to sync inbox"

# Saner copy/move dialogs
macro index C "<copy-message>?<toggle-mailboxes>" "copy a message to a mailbox"
macro index M "<save-message>?<toggle-mailboxes>" "move a message to a mailbox"


# Sidebar
bind index,pager B sidebar-toggle-visible

bind index,pager \CP sidebar-prev       # Ctrl-Shift-P - Previous Mailbox
bind index,pager \CN sidebar-next       # Ctrl-Shift-N - Next Mailbox
bind index,pager \CO sidebar-open       # Ctrl-Shift-O - Open Highlighted Mailbox


bind editor <Tab> complete-query
bind editor ^T complete

# View attachments properly.
bind attach <return> view-mailcap
